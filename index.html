<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChileAlerta - Monitor de Emergencias y Ambiente</title>
    <meta name="description"
        content="Monitoreo en tiempo real de calidad del aire y emergencias colaborativas en Chile">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0c1222">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ChileAlerta">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-72.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <span class="logo-icon">ğŸ‡¨ğŸ‡±</span>
                <h1>ChileAlerta</h1>
            </div>
            <span class="tagline">Monitor de Emergencias y Ambiente</span>
        </div>
        <div class="header-center">
            <div class="search-box" id="searchBox">
                <span class="search-icon">ğŸ”</span>
                <input type="text" id="searchInput" placeholder="Buscar direcciÃ³n en Chile..." autocomplete="off">
                <button class="search-clear" id="searchClear" style="display: none;">Ã—</button>
            </div>
            <div class="search-results" id="searchResults"></div>
        </div>
        <div class="header-right">
            <button class="btn btn-icon-only" id="btnTheme" title="Cambiar tema">
                <span class="btn-icon" id="themeIcon">ğŸŒ™</span>
            </button>
            <button class="btn btn-icon-only" id="btnNotifications" title="Notificaciones">
                <span class="btn-icon">ğŸ””</span>
                <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
            </button>
            <button class="btn btn-location" id="btnLocation" title="Mi ubicaciÃ³n">
                <span class="btn-icon">ğŸ“</span>
                <span class="btn-text">Mi ubicaciÃ³n</span>
            </button>
            <button class="btn btn-report" id="btnReport">
                <span class="btn-icon">ğŸš¨</span>
                <span class="btn-text">Reportar Emergencia</span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Loading Skeleton -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <span class="loading-text">Cargando ChileAlerta...</span>
            </div>
        </div>

        <!-- Map Container -->
        <div id="map" class="map-container"></div>

        <!-- Air Quality Panel -->
        <aside class="panel panel-air" id="panelAir">
            <div class="panel-header">
                <h2>ğŸŒ«ï¸ Calidad del Aire</h2>
                <button class="panel-toggle" id="toggleAir">âˆ’</button>
            </div>
            <div class="panel-content" id="contentAir">
                <div class="air-summary" id="airSummary">
                    <div class="ica-display" id="icaDisplay">
                        <span class="ica-value">--</span>
                        <span class="ica-label">ICA</span>
                    </div>
                    <div class="ica-info">
                        <span class="ica-status" id="icaStatus">Selecciona una estaciÃ³n</span>
                        <span class="ica-station" id="icaStation">--</span>
                    </div>
                    <button class="btn-share" id="btnShare" title="Compartir">
                        ğŸ“¤
                    </button>
                </div>
                <div class="health-recommendation" id="healthRecommendation">
                    <span class="health-icon" id="healthIcon">ğŸ’š</span>
                    <span class="health-text" id="healthText">Selecciona una estaciÃ³n para ver recomendaciones</span>
                </div>
                <div class="pollutants" id="pollutants">
                    <div class="pollutant">
                        <span class="pollutant-name">PM2.5</span>
                        <div class="pollutant-bar">
                            <div class="pollutant-fill" id="pm25Bar" style="width: 0%"></div>
                        </div>
                        <span class="pollutant-value" id="pm25Value">--</span>
                    </div>
                    <div class="pollutant">
                        <span class="pollutant-name">PM10</span>
                        <div class="pollutant-bar">
                            <div class="pollutant-fill" id="pm10Bar" style="width: 0%"></div>
                        </div>
                        <span class="pollutant-value" id="pm10Value">--</span>
                    </div>
                    <div class="pollutant">
                        <span class="pollutant-name">Oâ‚ƒ</span>
                        <div class="pollutant-bar">
                            <div class="pollutant-fill" id="o3Bar" style="width: 0%"></div>
                        </div>
                        <span class="pollutant-value" id="o3Value">--</span>
                    </div>
                    <div class="pollutant">
                        <span class="pollutant-name">NOâ‚‚</span>
                        <div class="pollutant-bar">
                            <div class="pollutant-fill" id="no2Bar" style="width: 0%"></div>
                        </div>
                        <span class="pollutant-value" id="no2Value">--</span>
                    </div>
                </div>
                <div class="history-chart" id="historyChartSection">
                    <h3>ğŸ“ˆ Historial 24h</h3>
                    <div class="chart-container">
                        <canvas id="airHistoryChart"></canvas>
                    </div>
                </div>
                <div class="region-filter" id="regionFilter">
                    <h3>ğŸ“ RegiÃ³n</h3>
                    <select id="regionSelect">
                        <option value="all">Todas las regiones</option>
                        <option value="RM">RegiÃ³n Metropolitana</option>
                        <option value="ValparaÃ­so">ValparaÃ­so</option>
                        <option value="BÃ­o BÃ­o">BÃ­o BÃ­o</option>
                        <option value="AraucanÃ­a">AraucanÃ­a</option>
                        <option value="O'Higgins">O'Higgins</option>
                        <option value="AysÃ©n">AysÃ©n</option>
                    </select>
                </div>
                <div class="ranking-section" id="rankingSection">
                    <h3>ğŸ† Ranking Ciudades</h3>
                    <div class="ranking-tabs">
                        <button class="ranking-tab active" data-type="clean">ğŸŒ¿ MÃ¡s Limpias</button>
                        <button class="ranking-tab" data-type="polluted">ğŸ’¨ MÃ¡s Contaminadas</button>
                    </div>
                    <div class="ranking-list" id="rankingList">
                        <!-- Populated by JS -->
                    </div>
                </div>
                <div class="my-zone" id="myZone">
                    <h3>ğŸ“ Mi Zona</h3>
                    <select id="myZoneSelect">
                        <option value="">Elige tu zona para alertas</option>
                        <option value="Pudahuel">Pudahuel</option>
                        <option value="Cerrillos">Cerrillos</option>
                        <option value="Cerro Navia">Cerro Navia</option>
                        <option value="El Bosque">El Bosque</option>
                        <option value="Independencia">Independencia</option>
                        <option value="La Florida">La Florida</option>
                        <option value="Las Condes">Las Condes</option>
                        <option value="Santiago Centro">Santiago Centro</option>
                        <option value="Puente Alto">Puente Alto</option>
                        <option value="Quilicura">Quilicura</option>
                        <option value="ConcepciÃ³n">ConcepciÃ³n</option>
                        <option value="Temuco">Temuco</option>
                        <option value="ValparaÃ­so">ValparaÃ­so</option>
                        <option value="Rancagua">Rancagua</option>
                        <option value="Coyhaique">Coyhaique</option>
                    </select>
                    <div class="zone-alert" id="zoneAlert" style="display: none;">
                        <span class="zone-alert-icon">âš ï¸</span>
                        <span class="zone-alert-text" id="zoneAlertText"></span>
                    </div>
                </div>
                <div class="stations-list" id="stationsList">
                    <h3>Estaciones <span id="stationCount">(15)</span></h3>
                    <div class="stations-scroll" id="stationsScroll">
                        <!-- Stations will be added dynamically -->
                    </div>
                </div>
            </div>
        </aside>

        <!-- Emergencies Panel -->
        <aside class="panel panel-emergencies" id="panelEmergencies">
            <div class="panel-header">
                <h2>ğŸš¨ Emergencias Activas</h2>
                <button class="panel-toggle" id="toggleEmergencies">âˆ’</button>
            </div>
            <div class="panel-content" id="contentEmergencies">
                <div class="emergency-filters">
                    <button class="filter-btn active" data-filter="all">Todas</button>
                    <button class="filter-btn" data-filter="corte">Cortes</button>
                    <button class="filter-btn" data-filter="accidente">Accidentes</button>
                    <button class="filter-btn" data-filter="incendio">Incendios</button>
                    <button class="filter-btn" data-filter="otro">Otros</button>
                </div>
                <div class="emergency-stats" id="emergencyStats">
                    <div class="stat">
                        <span class="stat-value" id="totalReports">0</span>
                        <span class="stat-label">Reportes</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="activeReports">0</span>
                        <span class="stat-label">Activos</span>
                    </div>
                </div>
                <div class="emergency-list" id="emergencyList">
                    <!-- Emergencies will be added dynamically -->
                    <div class="empty-state" id="emptyEmergencies">
                        <span class="empty-icon">âœ¨</span>
                        <p>No hay emergencias reportadas</p>
                        <small>Â¡Eso es bueno!</small>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Legend -->
        <div class="legend" id="legend">
            <div class="legend-title">Calidad del Aire</div>
            <div class="legend-items">
                <div class="legend-item">
                    <span class="legend-color" style="background: #00e676"></span>
                    <span>Bueno</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #ffeb3b"></span>
                    <span>Moderado</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #ff9800"></span>
                    <span>DaÃ±ino (sensibles)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #f44336"></span>
                    <span>DaÃ±ino</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #9c27b0"></span>
                    <span>Muy daÃ±ino</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #5d4037"></span>
                    <span>Peligroso</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Report Modal -->
    <div class="modal" id="reportModal">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸš¨ Reportar Emergencia</h2>
                <button class="modal-close" id="modalClose">Ã—</button>
            </div>
            <form class="modal-body" id="reportForm">
                <div class="form-group">
                    <label for="reportType">Tipo de emergencia</label>
                    <select id="reportType" required>
                        <option value="">Selecciona un tipo</option>
                        <option value="corte-agua">ğŸ’§ Corte de agua</option>
                        <option value="corte-luz">ğŸ’¡ Corte de luz</option>
                        <option value="corte-gas">ğŸ”¥ Corte de gas</option>
                        <option value="accidente">ğŸš— Accidente de trÃ¡nsito</option>
                        <option value="incendio">ğŸ”¥ Incendio</option>
                        <option value="inundacion">ğŸŒŠ InundaciÃ³n</option>
                        <option value="derrumbe">ğŸšï¸ Derrumbe</option>
                        <option value="otro">âš ï¸ Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reportDescription">DescripciÃ³n</label>
                    <textarea id="reportDescription" rows="3" placeholder="Describe brevemente la situaciÃ³n..."
                        required></textarea>
                </div>
                <div class="form-group">
                    <label for="reportLocation">UbicaciÃ³n</label>
                    <div class="location-input">
                        <input type="text" id="reportLocation" placeholder="DirecciÃ³n o referencia" required>
                        <button type="button" class="btn-use-location" id="useMyLocation">ğŸ“</button>
                    </div>
                    <small class="location-hint" id="locationHint">Haz clic en ğŸ“ para usar tu ubicaciÃ³n actual</small>
                </div>
                <input type="hidden" id="reportLat">
                <input type="hidden" id="reportLng">
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="btnCancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Enviar Reporte</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Onboarding Modal -->
    <div class="onboarding-overlay" id="onboardingOverlay" style="display: none;">
        <div class="onboarding-modal">
            <div class="onboarding-header">
                <span class="onboarding-icon">ğŸ‡¨ğŸ‡±</span>
                <h2>Bienvenido a ChileAlerta</h2>
            </div>
            <div class="onboarding-slides" id="onboardingSlides">
                <div class="onboarding-slide active" data-slide="0">
                    <div class="slide-icon">ğŸŒ«ï¸</div>
                    <h3>Calidad del Aire</h3>
                    <p>Monitorea la calidad del aire en tiempo real de 15 estaciones en Chile</p>
                </div>
                <div class="onboarding-slide" data-slide="1">
                    <div class="slide-icon">ğŸš¨</div>
                    <h3>Emergencias</h3>
                    <p>Reporta y visualiza emergencias colaborativas en tu zona</p>
                </div>
                <div class="onboarding-slide" data-slide="2">
                    <div class="slide-icon">ğŸ“</div>
                    <h3>Tu Zona</h3>
                    <p>Configura tu comuna favorita y recibe alertas automÃ¡ticas</p>
                </div>
            </div>
            <div class="onboarding-dots">
                <span class="dot active" data-dot="0"></span>
                <span class="dot" data-dot="1"></span>
                <span class="dot" data-dot="2"></span>
            </div>
            <div class="onboarding-actions">
                <button class="btn-skip" id="btnSkipOnboarding">Saltar</button>
                <button class="btn btn-primary" id="btnNextOnboarding">Siguiente</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js"></script>
    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('âœ… Service Worker registrado'))
                    .catch(err => console.log('Service Worker no disponible:', err));
            });
        }
    </script>
</body>

</html>